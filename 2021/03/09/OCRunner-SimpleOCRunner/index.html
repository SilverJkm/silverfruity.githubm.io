<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans,en,default">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="hotfix,iOS,Objective-C,">










<meta name="description" content="åœ¨æ­£æ–‡å¼€å§‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ç»™å‡ºçš„è¯­æ³•æ ‘è§£é‡Šæ‰§è¡Œ.gifï¼ŒOCRunnerçš„æ ¸å¿ƒè§£é‡Šæ‰§è¡Œéƒ¨åˆ†ä¹Ÿæ˜¯å¦‚æ­¤ã€‚  æœ¬å›¾å‡ºè‡ª: è™šæ‹Ÿæœºéšè°ˆï¼ˆä¸€ï¼‰ï¼šè§£é‡Šå™¨ï¼Œæ ‘éå†è§£é‡Šå™¨ï¼ŒåŸºäºæ ˆä¸åŸºäºå¯„å­˜å™¨ï¼Œå¤§æ‚çƒ© å¦‚æœä½ è®©æˆ‘ä»…ä»…åªé æ–‡å­—å°±èƒ½ç»™ä½ è§£é‡Šæ¸…æ¥š OCRunner æ˜¯æ€ä¹ˆè¿è¡Œèµ·æ¥çš„ï¼Œä½ ä»¬å¯èƒ½æ˜¯åœ¨ä¸ºéš¾æˆ‘å°è’‹ï¼Œè‚šå­é‡Œå¢¨æ°´çœŸçš„æ²¡é‚£ä¹ˆå¤šå•Šï¼Œå¤ªéš¾äº†ğŸ˜‚ã€‚æ‰€ä»¥åœ¨è¿™ä¸€å°èŠ‚ï¼Œæˆ‘ç»™å¤§å®¶å‡†å¤‡äº†ä¸€ä¸ªç®€å•ç‰ˆ OCRunnerï¼Œå¸Œæœ›å¤§å®¶èƒ½ä»è¿™ä¸ªä¾‹å­">
<meta name="keywords" content="hotfix,iOS,Objective-C">
<meta property="og:type" content="article">
<meta property="og:title" content="OCRunner-å®ç°ä¸€ä¸ªç®€å•ç‰ˆ OCRunner">
<meta property="og:url" content="https://silverfruity.github.io/2021/03/09/OCRunner-SimpleOCRunner/index.html">
<meta property="og:site_name" content="SilverFruity">
<meta property="og:description" content="åœ¨æ­£æ–‡å¼€å§‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ç»™å‡ºçš„è¯­æ³•æ ‘è§£é‡Šæ‰§è¡Œ.gifï¼ŒOCRunnerçš„æ ¸å¿ƒè§£é‡Šæ‰§è¡Œéƒ¨åˆ†ä¹Ÿæ˜¯å¦‚æ­¤ã€‚  æœ¬å›¾å‡ºè‡ª: è™šæ‹Ÿæœºéšè°ˆï¼ˆä¸€ï¼‰ï¼šè§£é‡Šå™¨ï¼Œæ ‘éå†è§£é‡Šå™¨ï¼ŒåŸºäºæ ˆä¸åŸºäºå¯„å­˜å™¨ï¼Œå¤§æ‚çƒ© å¦‚æœä½ è®©æˆ‘ä»…ä»…åªé æ–‡å­—å°±èƒ½ç»™ä½ è§£é‡Šæ¸…æ¥š OCRunner æ˜¯æ€ä¹ˆè¿è¡Œèµ·æ¥çš„ï¼Œä½ ä»¬å¯èƒ½æ˜¯åœ¨ä¸ºéš¾æˆ‘å°è’‹ï¼Œè‚šå­é‡Œå¢¨æ°´çœŸçš„æ²¡é‚£ä¹ˆå¤šå•Šï¼Œå¤ªéš¾äº†ğŸ˜‚ã€‚æ‰€ä»¥åœ¨è¿™ä¸€å°èŠ‚ï¼Œæˆ‘ç»™å¤§å®¶å‡†å¤‡äº†ä¸€ä¸ªç®€å•ç‰ˆ OCRunnerï¼Œå¸Œæœ›å¤§å®¶èƒ½ä»è¿™ä¸ªä¾‹å­">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://silverfruity.github.io/2021/03/09/OCRunner-SimpleOCRunner/eval_ast.gif">
<meta property="og:image" content="https://silverfruity.github.io/2021/03/09/OCRunner-SimpleOCRunner/OCRunnerExecute.png">
<meta property="og:updated_time" content="2021-03-09T09:37:11.920Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OCRunner-å®ç°ä¸€ä¸ªç®€å•ç‰ˆ OCRunner">
<meta name="twitter:description" content="åœ¨æ­£æ–‡å¼€å§‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ç»™å‡ºçš„è¯­æ³•æ ‘è§£é‡Šæ‰§è¡Œ.gifï¼ŒOCRunnerçš„æ ¸å¿ƒè§£é‡Šæ‰§è¡Œéƒ¨åˆ†ä¹Ÿæ˜¯å¦‚æ­¤ã€‚  æœ¬å›¾å‡ºè‡ª: è™šæ‹Ÿæœºéšè°ˆï¼ˆä¸€ï¼‰ï¼šè§£é‡Šå™¨ï¼Œæ ‘éå†è§£é‡Šå™¨ï¼ŒåŸºäºæ ˆä¸åŸºäºå¯„å­˜å™¨ï¼Œå¤§æ‚çƒ© å¦‚æœä½ è®©æˆ‘ä»…ä»…åªé æ–‡å­—å°±èƒ½ç»™ä½ è§£é‡Šæ¸…æ¥š OCRunner æ˜¯æ€ä¹ˆè¿è¡Œèµ·æ¥çš„ï¼Œä½ ä»¬å¯èƒ½æ˜¯åœ¨ä¸ºéš¾æˆ‘å°è’‹ï¼Œè‚šå­é‡Œå¢¨æ°´çœŸçš„æ²¡é‚£ä¹ˆå¤šå•Šï¼Œå¤ªéš¾äº†ğŸ˜‚ã€‚æ‰€ä»¥åœ¨è¿™ä¸€å°èŠ‚ï¼Œæˆ‘ç»™å¤§å®¶å‡†å¤‡äº†ä¸€ä¸ªç®€å•ç‰ˆ OCRunnerï¼Œå¸Œæœ›å¤§å®¶èƒ½ä»è¿™ä¸ªä¾‹å­">
<meta name="twitter:image" content="https://silverfruity.github.io/2021/03/09/OCRunner-SimpleOCRunner/eval_ast.gif">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://silverfruity.github.io/2021/03/09/OCRunner-SimpleOCRunner/">





  <title>OCRunner-å®ç°ä¸€ä¸ªç®€å•ç‰ˆ OCRunner | SilverFruity</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">SilverFruity</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            åˆ†ç±»
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://silverfruity.github.io/2021/03/09/OCRunner-SimpleOCRunner/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jiang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SilverFruity">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">OCRunner-å®ç°ä¸€ä¸ªç®€å•ç‰ˆ OCRunner</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-03-09T17:25:49+08:00">
                2021-03-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/OpenSource/" itemprop="url" rel="index">
                    <span itemprop="name">OpenSource</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/03/09/OCRunner-SimpleOCRunner/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2021/03/09/OCRunner-SimpleOCRunner/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2021/03/09/OCRunner-SimpleOCRunner/" class="leancloud_visitors" data-flag-title="OCRunner-å®ç°ä¸€ä¸ªç®€å•ç‰ˆ OCRunner">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡&#58;</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  4.7k å­—
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  19 åˆ†é’Ÿ
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>åœ¨æ­£æ–‡å¼€å§‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ç»™å‡ºçš„è¯­æ³•æ ‘è§£é‡Šæ‰§è¡Œ.gifï¼ŒOCRunnerçš„æ ¸å¿ƒè§£é‡Šæ‰§è¡Œéƒ¨åˆ†ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p>
<img src="/2021/03/09/OCRunner-SimpleOCRunner/eval_ast.gif">
<p><a href="https://www.iteye.com/blog/rednaxelafx-492667" target="_blank" rel="noopener">æœ¬å›¾å‡ºè‡ª: è™šæ‹Ÿæœºéšè°ˆï¼ˆä¸€ï¼‰ï¼šè§£é‡Šå™¨ï¼Œæ ‘éå†è§£é‡Šå™¨ï¼ŒåŸºäºæ ˆä¸åŸºäºå¯„å­˜å™¨ï¼Œå¤§æ‚çƒ©</a></p>
<p>å¦‚æœä½ è®©æˆ‘ä»…ä»…åªé æ–‡å­—å°±èƒ½ç»™ä½ è§£é‡Šæ¸…æ¥š OCRunner æ˜¯æ€ä¹ˆè¿è¡Œèµ·æ¥çš„ï¼Œä½ ä»¬å¯èƒ½æ˜¯åœ¨ä¸ºéš¾æˆ‘å°è’‹ï¼Œè‚šå­é‡Œå¢¨æ°´çœŸçš„æ²¡é‚£ä¹ˆå¤šå•Šï¼Œå¤ªéš¾äº†ğŸ˜‚ã€‚æ‰€ä»¥åœ¨è¿™ä¸€å°èŠ‚ï¼Œæˆ‘ç»™å¤§å®¶å‡†å¤‡äº†ä¸€ä¸ªç®€å•ç‰ˆ OCRunnerï¼Œå¸Œæœ›å¤§å®¶èƒ½ä»è¿™ä¸ªä¾‹å­ä¸­ï¼ŒçœŸæ­£çŸ¥é“å®ƒæ˜¯å¦‚ä½•è¿è¡Œçš„ã€‚</p>
<p>å¸Œæœ›ä½ ä»¬çœ‹è§é¡¹ç›®ä¸­çš„ SingleEngine ç±»ä¸è¦ç¬‘ï¼ˆå“ˆå“ˆå“ˆï¼‰ï¼Œæˆ‘åªæ˜¯æƒ³è¡¨è¾¾ å•ç¼¸å‘åŠ¨æœº çš„æ„æ€ - _ -ï¼Œæˆ‘å¿ƒçˆ±çš„å°æ‘©æ‰˜å°±æ˜¯å•ç¼¸æ‹–æ‹‰æœºã€‚</p>
<p>æœ¬èŠ‚å‡è®¾è¯»è€…å¹¶ä¸å…·å¤‡ç¼–è¯‘ç›¸å…³çš„çŸ¥è¯†ã€‚</p>
<p>æœ¬æ–‡å¯¹ lex å’Œ yacc ä»‹ç»æœ‰é™ï¼Œå…³äº flex å’Œ bison çš„è¯¦ç»†ä½¿ç”¨å¯ä»¥å‚ç…§ã€Šflexä¸bisonä¸­æ–‡ç‰ˆã€‹æˆ–è€… ã€Šflex&amp;bisonã€‹ã€‚</p>
<p><a href="https://github.com/SilverFruity/SimpleOCRunnerDemo" target="_blank" rel="noopener">Demoæºç </a>ï¼Œå»ºè®®ä½¿ç”¨ <code>git clone</code> çš„å½¢å¼ä¸‹è½½æºç ï¼Œæ¯ä¸ªå°èŠ‚çš„ç›¸åº”æºç éƒ½å¯¹åº”åœ¨å„è‡ªçš„ commit é‡Œã€‚é€šè¿‡è¾¹çœ‹æ–‡ç« è¾¹é˜…è¯»æºç çš„å½¢å¼é£Ÿç”¨ï¼Œæ›´é¦™å“Ÿã€‚</p>
<p>æˆ‘ä»¬å°†é€šè¿‡ä»¥ä¸‹è¿™ä¸ªä¾‹å­ï¼Œæ¥è¯´æ˜ OCRunner æ‰§è¡Œçš„ä¸»è¦å®ç°ï¼Œå°†çœç•¥è¡¥ä¸æ–‡ä»¶çš„åºåˆ—åŒ–å’ŒåŠ è½½è¿‡ç¨‹ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è®©è¿™æ®µæ–‡æœ¬åƒ C ä¸€æ ·æ‰§è¡Œï¼Œå¹¶ä¸”æœ€ç»ˆå˜é‡ <strong>c</strong> çš„å€¼ä¸º 5 ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> d = <span class="number">2</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> arg0, <span class="keyword">double</span> arg1)</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arg0 + arg1 + d;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> a = <span class="number">1</span>; </span><br><span class="line"><span class="keyword">double</span> b = <span class="number">2.0</span>;</span><br><span class="line"><span class="keyword">int</span> c = add(a, b);</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h4 id="è¯æ³•åˆ†æå™¨"><a href="#è¯æ³•åˆ†æå™¨" class="headerlink" title="è¯æ³•åˆ†æå™¨"></a>è¯æ³•åˆ†æå™¨</h4><p>é€šä¿—æ¥è¯´ï¼Œè¯æ³•åˆ†æå°±æ˜¯å°†ç¬¦åˆç›¸åº”è§„åˆ™çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ª <strong>Token</strong>ï¼ˆå¯ä»¥å°†å®ƒçœ‹ä¸ºä¸€ä¸ªç”±<strong>ç±»å‹</strong>å’Œ<strong>å€¼</strong>ä¸¤ä¸ªå±æ€§ç»„æˆçš„ç±»ï¼‰ã€‚</p>
<p>æ¯”å¦‚å½“åŒ¹é…åˆ° â€˜intâ€™ æ—¶ï¼Œâ€™intâ€™ å°†ä¼šè¢«è½¬æ¢ä¸º INT_TYPE ï¼Œä¹Ÿæ˜¯å°±æ˜¯ Token çš„ç±»å‹ï¼Œå®ƒçš„å€¼å¯ä»¥æ˜¯æˆ‘ä»¬åç»­çš„å€¼ç±»å‹ï¼ˆä¸€ä¸ªæšä¸¾ï¼‰ã€‚</p>
<p>å†æ¯”å¦‚å½“åŒ¹é…åˆ° â€˜1.0â€™ å­—ç¬¦ä¸²æ—¶ï¼Œâ€™1.0â€™ è¢«è½¬æ¢ä¸º DOUBLE_LITERAL ç±»å‹å¹¶ä¸” Token æ­¤æ—¶çš„å€¼ä¸ºæµ®ç‚¹æ•° 1.0ã€‚</p>
<p>é’ˆå¯¹è¿™é‡Œä¾‹å­ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰å¦‚ä¸‹å‡ ä¸ªè§„åˆ™:</p>
<ol>
<li>å…³é”®è¯: intã€doubleã€return</li>
<li><p>æ ‡è¯†ç¬¦ï¼ˆå¯ä»¥æ˜¯å˜é‡åã€ç±»å‹ç­‰ï¼‰:  ä»¥å­—æ¯ã€_ ã€$ å¼€å¤´çš„å­—ç¬¦ä¸²</p>
</li>
<li><p>æ•°å€¼:  æ•´æ•°ã€æµ®ç‚¹æ•°</p>
</li>
<li>ç¬¦å·: ( ) ; { } , = +</li>
</ol>
<p>ä¸Šè¿°éƒ½æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥éœ€è¦è¯†åˆ«çš„ï¼Œæˆ‘ä»¬å°†ç›´æ¥ä½¿ç”¨ flex å®Œæˆè¯æ³•åˆ†æå™¨ã€‚</p>
<p>è¯æ³•åˆ†æå™¨ <strong>lexer.l</strong> ä¸­çš„ä»£ç :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">%option noyywrap</span><br><span class="line">%&#123;</span><br><span class="line">    <span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"y.tab.h"</span></span></span><br><span class="line">%&#125;</span><br><span class="line">%%</span><br><span class="line"><span class="string">","</span> &#123; <span class="keyword">return</span> <span class="string">','</span>;&#125;</span><br><span class="line"><span class="string">";"</span> &#123; <span class="keyword">return</span> <span class="string">';'</span>; &#125;</span><br><span class="line"><span class="string">"("</span> &#123; <span class="keyword">return</span> <span class="string">'('</span>; &#125;</span><br><span class="line"><span class="string">")"</span> &#123; <span class="keyword">return</span> <span class="string">')'</span>; &#125;</span><br><span class="line"><span class="string">"&#123;"</span> &#123; <span class="keyword">return</span> <span class="string">'&#123;'</span>; &#125;</span><br><span class="line"><span class="string">"&#125;"</span> &#123; <span class="keyword">return</span> <span class="string">'&#125;'</span>; &#125;</span><br><span class="line"><span class="string">"="</span> &#123; <span class="keyword">return</span> <span class="string">'='</span>; &#125;</span><br><span class="line"><span class="string">"+"</span> &#123; <span class="keyword">return</span> <span class="string">'+'</span>; &#125;</span><br><span class="line"><span class="string">"-"</span> &#123; <span class="keyword">return</span> <span class="string">'-'</span>; &#125;</span><br><span class="line"><span class="string">"int"</span> &#123; <span class="keyword">return</span> INT_TYPE; &#125;</span><br><span class="line"><span class="string">"double"</span> &#123; <span class="keyword">return</span> DOUBLE_TYPE; &#125;</span><br><span class="line"><span class="string">"return"</span> &#123; <span class="keyword">return</span>  RETURN; &#125;</span><br><span class="line"><span class="comment">// æµ®ç‚¹æ•°</span></span><br><span class="line">[<span class="number">0</span><span class="number">-9</span>]+\.[<span class="number">0</span><span class="number">-9</span>]+ &#123; yylval.doubleValue = atof(yytext); <span class="keyword">return</span> DOUBLE_LITERAL; &#125;</span><br><span class="line"><span class="comment">// æ•´æ•°</span></span><br><span class="line">[<span class="number">1</span><span class="number">-9</span>][<span class="number">0</span><span class="number">-9</span>]* &#123;  yylval.intValue = (<span class="keyword">int</span>)strtol(yytext, <span class="literal">NULL</span>, <span class="number">10</span>); <span class="keyword">return</span> INTETER_LITERAL; &#125;</span><br><span class="line"><span class="comment">// æ ‡è¯†ç¬¦</span></span><br><span class="line">[A-Za-z_$][A-Za-z_$<span class="number">0</span><span class="number">-9</span>]* &#123; yylval.stringValue = yytext; <span class="keyword">return</span> IDENTIFIER; &#125;</span><br><span class="line">%%</span><br></pre></td></tr></table></figure>
<h5 id="Flexè¯­æ³•ç®€å•ç®€ä»‹"><a href="#Flexè¯­æ³•ç®€å•ç®€ä»‹" class="headerlink" title="Flexè¯­æ³•ç®€å•ç®€ä»‹"></a>Flexè¯­æ³•ç®€å•ç®€ä»‹</h5><ul>
<li>ä¸ŠåŠéƒ¨åˆ†çš„<code>%{  %}</code> ä¸»è¦ç”¨äºä¹¦å†™ C ä»£ç ï¼Œå¼•å…¥å¤´æ–‡ä»¶ï¼Œè‡ªå®šä¹‰å‡½æ•°ç­‰ç­‰ï¼Œæœ€ç»ˆä¼šä»¥æ–‡æœ¬çš„å½¢å¼è¢«æ·»åŠ åˆ° <strong>lexer.yy.c</strong> ä¸­ï¼ˆ Demo ä¸­ä½ å¯ä»¥åœ¨ç¼–è¯‘ç¼“å­˜ä¸­æ‰¾åˆ°è¯¥æ–‡ä»¶ï¼‰ã€‚</li>
<li>ä¸‹åŠéƒ¨åˆ†çš„ <code>%%  %%</code>å°±æ˜¯å…³é”®äº†ï¼Œé€šè¿‡ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œå°†ç¬¦åˆè§„åˆ™çš„å­—ç¬¦æµè½¬æ¢ä¸ºç›¸åº”çš„ token ã€‚</li>
<li><strong>yylval</strong>è¿™åˆ™æ˜¯ Token çš„å€¼ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒä¸€ä¸ª int ç±»å‹ï¼Œä½†æ˜¯åœ¨ bison ä¸­å¯ä»¥ä½¿ç”¨ <strong>%union</strong> å£°æ˜æ¥é‡æ–°å®šä¹‰å®ƒçš„ç±»å‹ã€‚</li>
</ul>
<p>å½“æˆ‘ä»¬è°ƒç”¨è¯æ³•åˆ†æå™¨åï¼Œä¸Šè¿°æ–‡æœ¬å°†ä¼šåšå‡ºå¦‚ä¸‹è½¬æ¢ï¼Œå¦‚ä½•å¯¹å®ƒè¿›è¡Œè¯­æ³•åŒ¹é…ï¼Œè¿™å°±æ˜¯æ¥ä¸‹æ¥çš„å†…å®¹äº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">	int          d      =       2       ;</span><br><span class="line">&gt; INT_TYPE IDENTIFIER = INTETER_LITERAL ;</span><br><span class="line">  int      add        (    int       arg0     ,   double      arg1     ) &#123;</span><br><span class="line">&gt; INT_TYPE IDENTIFIER ( INT_TYPE IDENTIFIER , DOUBLE_TYPE IDENTIFIER ) &#123;</span><br><span class="line">  return     arg0   +    arg1    +     d      ;</span><br><span class="line">&gt; RETURN IDENTIFIER + IDENTIFIER + IDENTIFIER ;</span><br><span class="line">  &#125;</span><br><span class="line">&gt; &#125;</span><br><span class="line">	int          a      =       1       ;</span><br><span class="line">&gt; INT_TYPE IDENTIFIER = INTETER_LITERAL ;</span><br><span class="line">  double          b      =         2.0     ;</span><br><span class="line">&gt; DOUBLE_TYPE IDENTIFIER = INTETER_LITERAL ;</span><br><span class="line">  int           c     =    add     (     a      ,      b     ) ;</span><br><span class="line">&gt; INT_TYPE IDENTIFIER = IDENTIFIER ( IDENTIFIER , IDENTIFIER ) ;</span><br></pre></td></tr></table></figure>
<h4 id="è¯­æ³•åˆ†æå™¨"><a href="#è¯­æ³•åˆ†æå™¨" class="headerlink" title="è¯­æ³•åˆ†æå™¨"></a>è¯­æ³•åˆ†æå™¨</h4><p>è¯­æ³•åˆ†æå™¨ <strong>parser.y</strong> ä¸­çš„ä»£ç ï¼Œç›®å‰è¿˜æ²¡æœ‰ä»»ä½•è¯­æ³•ç›¸å…³çš„é€»è¾‘ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">%&#123;</span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> YYDEBUG 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> YYERROR_VERBOSE</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">yylex</span> <span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">yyerror</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s)</span></span>;</span><br><span class="line">%&#125;</span><br><span class="line">%<span class="keyword">union</span>&#123;</span><br><span class="line">    <span class="keyword">uint64_t</span> intValue;</span><br><span class="line">    <span class="keyword">double</span> doubleValue; </span><br><span class="line">    <span class="keyword">char</span> *stringValue;</span><br><span class="line">    __unsafe_unretained id object;</span><br><span class="line">&#125;</span><br><span class="line">%token&lt;stringValue&gt; IDENTIFIER</span><br><span class="line">%token&lt;doubleValue&gt; DOUBLE_LITERAL</span><br><span class="line">%token&lt;intValue&gt; 		INTETER_LITERAL</span><br><span class="line">%token INT_TYPE</span><br><span class="line">%token DOUBLE_TYPE</span><br><span class="line">%token RETURN</span><br><span class="line">%start door</span><br><span class="line">%type&lt;object&gt; statements</span><br><span class="line"></span><br><span class="line">%%</span><br><span class="line">door: </span><br><span class="line"><span class="comment">/*empty*/</span></span><br><span class="line">| statements;</span><br><span class="line">;</span><br><span class="line">statements:</span><br><span class="line"><span class="comment">/*empty*/</span></span><br><span class="line">;</span><br><span class="line">%%</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">yyerror</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s)</span></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Yaccè¯­æ³•ç®€å•ä»‹ç»"><a href="#Yaccè¯­æ³•ç®€å•ä»‹ç»" class="headerlink" title="Yaccè¯­æ³•ç®€å•ä»‹ç»"></a>Yaccè¯­æ³•ç®€å•ä»‹ç»</h5><ul>
<li><p><code>%{  %}</code>ä¸­å’Œ Flex æ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯å…³äºè¿™é‡Œçš„ yylex å’Œ yyerror ä¸¤ä¸ªå‡½æ•°ï¼Œä»–ä»¬ä¸¤å…„å¼Ÿæ˜¯å¿…é¡»å¼•å…¥çš„</p>
</li>
<li><p><strong>%union</strong> å¦‚ä¹‹å‰æ‰€è¯´ï¼Œå°†é‡æ–°å®šä¹‰ <strong>yylval</strong> çš„ç±»å‹ï¼Œå¯ä»¥åœ¨è¯æ³•åˆ†æé˜¶æ®µï¼Œä¿ç•™ä¸åŒç±»å‹çš„å€¼</p>
</li>
<li><p><strong>%token\&lt;stringValue> IDENTIFIER</strong> å°†åœ¨ yacc å£°æ˜ä¸€ä¸ªåä¸º IDENTIFIER çš„ tokenï¼Œå¹¶ä¸”è¡¨æ˜äº†å®ƒçš„å€¼ç±»å‹ï¼ˆè·å–å®ƒçš„å€¼æ—¶ï¼Œå°†ä» union çš„å“ªä¸ªå­—æ®µå–å€¼ï¼‰ã€‚</p>
</li>
<li><p><strong>%type\&lt;object> statements</strong> ä¸ <strong>%token</strong> ä¸åŒæ˜¯çš„ï¼Œè¿™æ˜¯å£°æ˜ä¸€æ¡è§„çº¦ï¼ˆè¯­æ³•è§„åˆ™ï¼‰ã€‚</p>
</li>
<li><p><strong>%start</strong> å°†ä»æŒ‡å®šçš„è§„çº¦ï¼Œä½œä¸ºè¯­æ³•è§£æå™¨çš„å…¥å£</p>
</li>
<li><p>å…³äº <code>%{  %}</code> å’Œ <code>%% %%</code>ï¼Œä¸ flex ä¸åŒæ˜¯çš„ï¼Œ<code>%% %%</code> ä¸­é‡‡ç”¨ BNF æ–‡æ³•çš„å˜ç§æ¥æè¿°è¯­æ³•è§„åˆ™ï¼Œå½“ä½ æ˜ç™½äº†å®ƒçš„è¿ä½œæ–¹å¼ï¼Œå…¶å®å¯è¯»æ€§è¿˜æ˜¯å¾ˆé«˜çš„ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬éœ€è¦ä½¿ç”¨ <strong>lexer.l</strong> ä»¥åŠ <strong>parser.y</strong> ï¼Œå®Œæˆå¯¹ <code>a = 1 + 2; b = 2.0 - 1.0;</code> çš„è¯†åˆ«ï¼Œå¹¶ä¸”æ‰“å°è®¡ç®—ç»“æœã€‚</p>
<p>ä½¿ç”¨ Yacc å®ç°å¯¹ä¸¤ä¸ªè¡¨è¾¾å¼çš„è¯†åˆ«ä»¥åŠè®¡ç®—çš„æºç ï¼Œå·²ç»åœ¨ä»“åº“ <a href="https://github.com/SilverFruity/SimpleOCRunnerDemo" target="_blank" rel="noopener">SimpleOCRunnerDemo</a> çš„ <a href="https://github.com/SilverFruity/SimpleOCRunnerDemo/commit/c09d35868207ec44e7a4854552e9b19246f561d1" target="_blank" rel="noopener">ä¸åŒç±»å‹ç®€å•è®¡ç®—çš„ä¾‹å­</a>  ä¸­å®Œæˆï¼Œå¯¹ Yacc è¯­æ³•ä¸ç†Ÿæ‚‰çš„å°ä¼™ä¼´ï¼Œå¯ä»¥çœ‹å®Œè¿™ä¸€å°éƒ¨åˆ†ï¼Œå†å»çœ‹æºç ã€‚ä¸ºé™åˆ¶æœ¬æ–‡ç¯‡å¹…ï¼Œæˆ‘å°†å°½é‡å‡å°‘åœ¨æ–‡ä¸­çš„ä»£ç ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬å…ˆå°† <code>a = 1 + 2; b = 2.0 - 1.0;</code> è½¬æ¢ä¸º Token :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¡¨è¾¾å¼ 1</span></span><br><span class="line">IDENTIFIER = INTETER_LITERAL + INTETER_LITERAL ;</span><br><span class="line"><span class="comment">//è¡¨è¾¾å¼ 2</span></span><br><span class="line">IDENTIFIER = DOUBLE_LITERAL - DOUBLE_LITERAL ;</span><br></pre></td></tr></table></figure>
<p>é€šä¿—æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬é€ä¸ªé€ä¸ªçš„è¯»å…¥æ¯ä¸ª Tokenï¼Œæˆ‘ä»¬è¦åŒ¹é…ä¸Šè¿°ä¸¤ä¸ªè¡¨è¾¾å¼ï¼Œå¯ä»¥æœ‰ä»¥ä¸‹ä»£ç é€»è¾‘ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">extern</span> Token <span class="title">nextToken</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="keyword">while</span>(token = nextToken()):</span><br><span class="line">	<span class="keyword">if</span> token == IDENTIFIER:</span><br><span class="line">		<span class="keyword">if</span> nextToken() == <span class="string">'='</span>:</span><br><span class="line">			 token = nextToken();</span><br><span class="line">		   <span class="keyword">if</span> token == INTETER_LITERAL:</span><br><span class="line">		   	 <span class="keyword">if</span> nextToken() == <span class="string">'+'</span>:</span><br><span class="line">		   	 	 <span class="keyword">if</span> nextToken() == INTETER_LITERAL:</span><br><span class="line">		   	 	   <span class="comment">//å®Œæˆ IDENTIFIER = INTETER_LITERAL + INTETER_LITERAL ;</span></span><br><span class="line">		   	 	 	 <span class="keyword">return</span></span><br><span class="line">		   <span class="keyword">if</span> token == DOUBLE_LITERAL:</span><br><span class="line">		   	 <span class="keyword">if</span> nextToken() == <span class="string">'-'</span>:</span><br><span class="line">		   	 	 <span class="keyword">if</span> nextToken() == DOUBLE_LITERAL:</span><br><span class="line">		   	 	   <span class="comment">//å®Œæˆ IDENTIFIER = DOUBLE_LITERAL - DOUBLE_LITERAL ;</span></span><br><span class="line">		   	 	 	 <span class="keyword">return</span></span><br><span class="line">	<span class="keyword">break</span>;</span><br><span class="line">	</span><br><span class="line"><span class="comment">// è¿™ä¸ªé€»è¾‘ä½¿ç”¨ Yacc ä»£ç å¯ä»¥è¡¨ç¤ºä¸º</span></span><br><span class="line">assign_expression:</span><br><span class="line">IDENTIFIER <span class="string">'='</span> expression</span><br><span class="line">;</span><br><span class="line">expression:</span><br><span class="line">INTETER_LITERAL + INTETER_LITERAL</span><br><span class="line">| DOUBLE_LITERAL - DOUBLE_LITERAL</span><br><span class="line">;</span><br><span class="line"><span class="comment">//  NAME: å…¶å®æ˜¯å®ç°äº†ä¸€æ¡è§„çº¦ï¼ˆè¯­æ³•è§„åˆ™ï¼‰ï¼Œå§‹ç»ˆå¯¹ä¸‹ä¸€ä¸ªTokenè¿›è¡ŒåŒ¹é…ï¼Œå…¶å®ä¸­çš„ | è¡¨ç¤ºä¸€ä¸ª or çš„é€»è¾‘åˆ†æ”¯ï¼Œè¿˜æœ‰å°±æ˜¯è§„çº¦å¯ä»¥é€’å½’ä½¿ç”¨ã€‚æ›´å¤šçš„Yaccè¯­æ³•å¯ä»¥å‚é˜…ã€Šflexä¸bisonä¸­æ–‡ç‰ˆã€‹53é¡µã€‚</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>ç°åœ¨è®©æˆ‘ä»¬å›åˆ°åˆå§‹ç›®æ ‡ï¼Œç°åœ¨æˆ‘ä»¬è¦å®ç°å®ƒç›¸åº”çš„è¯­æ³•åˆ†æå™¨:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> d = <span class="number">2</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> arg0, <span class="keyword">double</span> arg1)</span></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arg0 + arg1 + d;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> a = <span class="number">1</span>; </span><br><span class="line"><span class="keyword">double</span> b = <span class="number">2.0</span>;</span><br><span class="line"><span class="keyword">int</span> c = add(a, b);</span><br></pre></td></tr></table></figure>
<p>è¿˜è®°å¾—æˆ‘ä»¬åœ¨è¯æ³•åˆ†æå™¨ä¸­çš„å®ç°å—ï¼Œæ–‡æœ¬åˆ° Token çš„è½¬æ¢è§„åˆ™:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> -&gt; INT_TYPE</span><br><span class="line"><span class="keyword">double</span> -&gt; DOUBLE_TYPE</span><br><span class="line">'a-zA-z' -&gt; IDENTIFIER</span><br><span class="line"><span class="number">1</span> -&gt; INTEGER_LITERAL</span><br><span class="line"><span class="number">2.0</span> -&gt; DOUBLE_LITERAL</span><br><span class="line">()&#123;&#125;+,=; -&gt; ()&#123;&#125;+,=; <span class="comment">//å­—ç¬¦</span></span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ç¡®å®šçš„æ˜¯ï¼Œå‡ºç°æœ€å¤šçš„ Token ç»„åˆä¸ºï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// int/double xxx</span></span><br><span class="line">TYPE IDENTIFIER</span><br></pre></td></tr></table></figure>
<p>åŒæ—¶æˆ‘ä»¬çš„æ•°æ®ç±»å‹æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«ä¸º int / double ï¼Œå› æ­¤æˆ‘ä»¬çš„ç¬¬ä¸€æ¡è§„çº¦ä¸º:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">specifier_type:</span><br><span class="line">INT_TYPE</span><br><span class="line">|DOUBLE_TYPE</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹æ‰€æœ‰çš„å£°æ˜è¯­æ³•ï¼ˆå˜é‡ã€å‡½æ•°ï¼‰:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a</span><br><span class="line"><span class="keyword">double</span> b = <span class="number">2.0</span></span><br><span class="line"><span class="keyword">int</span> add(<span class="keyword">int</span> arg0, <span class="keyword">int</span> arg1)</span><br></pre></td></tr></table></figure>
<p>é’ˆå¯¹ä»¥ä¸Šä¸‰ä¸ªå£°æ˜è¯­æ³•ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ä¸ªè§„çº¦åŒ¹é…ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¹int/double xxxç»Ÿä¸€å¤„ç†ï¼Œå…¶ä»–çš„å•ç‹¬å¤„ç†å³å¯</span></span><br><span class="line">declaration:</span><br><span class="line">specifier_type IDENTIFIER</span><br><span class="line">| declaration <span class="string">'='</span> expression</span><br><span class="line">| declaration <span class="string">'('</span> declaration_list <span class="string">')'</span></span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"><span class="comment">// declaration_list å°±æ˜¯ä¸€ä¸ªä»¥','ä¸ºåˆ†éš”ç¬¦çš„åˆ—è¡¨å¤„ç†</span></span><br><span class="line">declaration_list:</span><br><span class="line">declaration</span><br><span class="line">| declaration_list <span class="string">','</span> declaration</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å¤„ç†è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬è¿™é‡Œå¯¹è¡¨è¾¾å¼ç®€å•çš„å®šä¹‰ä¸ºï¼š â€˜=â€™  å’Œ â€˜returnâ€™ å³éƒ¨åˆ†ï¼Œä¸åŒ…å« â€˜;â€™ ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1.0</span></span><br><span class="line">a</span><br><span class="line">a + b</span><br><span class="line">add(a, b)</span><br></pre></td></tr></table></figure>
<p>é’ˆå¯¹ä»¥ä¸Šè¡¨è¾¾å¼ï¼Œå¯ä»¥ä½¿ç”¨çš„æœ€ç®€è§„çº¦</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤„ç† 1ã€1.0ã€a</span></span><br><span class="line">primary_expression:</span><br><span class="line">IDENTIFIER</span><br><span class="line">| INTETER_LITERAL</span><br><span class="line">| DOUBLE_LITERAL</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç† a + bã€add(a, b)</span></span><br><span class="line">expression:</span><br><span class="line">primary_expression</span><br><span class="line">| expression <span class="string">'+'</span> expression</span><br><span class="line">| expression <span class="string">'('</span> expression_list <span class="string">')'</span></span><br><span class="line">;</span><br><span class="line"><span class="comment">// expression_listä¸declaration_listé›·åŒ</span></span><br></pre></td></tr></table></figure>
<p>å®ç°äº†expressionè§„çº¦åï¼Œå®ç° <strong>return</strong> å°±å¾ˆç®€å•äº† <code>RETURN expression</code>ã€‚</p>
<p>æˆ‘ä»¬å°† <code>{ ... }</code> è¿™ä¸ªæ•´ä½“ç»Ÿç§°ä¸ºä¸€ä¸ªå—æˆ–è€…æ˜¯ä½œç”¨åŸŸï¼Œå®ƒç”±è¡¨è¾¾å¼çš„åˆ—è¡¨æˆ–è€…å­ä½œç”¨åŸŸç»„æˆã€‚</p>
<p>åœ¨å®Œæˆå¯¹å—çš„åŒ¹é…ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè¦èƒ½å¤ŸåŒ¹é…å¤šä¸ªä¸åŒçš„å£°æ˜ã€‚</p>
<p>æ ¹æ®å·²ç»å®ç°çš„è§„çº¦ï¼Œåœ¨å…¶å°¾éƒ¨åŠ ä¸€ä¸ª<code>;</code>ï¼Œå®Œæˆä¸€ä¸ªå£°æ˜çš„åŒ¹é…ã€‚</p>
<p>å› æ­¤å®ç°äº† <code>statement</code> è§„çº¦ï¼Œç”¨ä»¥å°†å„ä¸ªå£°æ˜çš„è§„çº¦æ•´åˆã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">statement:</span><br><span class="line">declaration &apos;;&apos;</span><br><span class="line">| expression &apos;;&apos;</span><br><span class="line">| RETURN expression &apos;;&apos;</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<p>å…¶æ¬¡ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åŒ¹é…ä½œç”¨åŸŸä¸­çš„å¤šä¸ªå£°æ˜æˆ–è€…é›¶ä¸ªå£°æ˜ï¼Œé‚£ä¹ˆ <code>statement_list</code> åº”è¿è€Œç”Ÿã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">statement_list: </span><br><span class="line">| statement</span><br><span class="line">| statement_list statement</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å·²ç»èƒ½å¤Ÿå¤„ç†ä½œç”¨åŸŸä¸­çš„å£°æ˜åˆ—è¡¨äº†ï¼Œé‚£ä¹ˆé’ˆå¯¹ä½œç”¨åŸŸçš„è§„çº¦å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scope_statements:</span><br><span class="line">&apos;&#123;&apos; statement_list &apos;&#125;&apos;</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<p>ç›®å‰å°±åªæœ‰å¯¹å‡½æ•°çš„å£°æ˜æ²¡æœ‰å®ç°äº†ï¼Œä½†æˆ‘ä»¬æ—©å·²åœ¨ <code>declaration</code> ä¸­å®ç°äº†å¯¹äº† <code>int add(int a, double b)</code> è¯†åˆ«ã€‚<br>æœ€ç»ˆçš„ <code>statement</code> è§„çº¦å¦‚ä¸‹:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">statement:</span><br><span class="line">declaration <span class="string">';'</span></span><br><span class="line">| expression <span class="string">';'</span></span><br><span class="line">| RETURN expression <span class="string">';'</span></span><br><span class="line"><span class="comment">//å‡½æ•°å£°æ˜çš„è¯†åˆ«</span></span><br><span class="line">| declaration scope_statements</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<p>æœ¬å°èŠ‚ç›¸å…³ä»£ç ï¼Œåœ¨<a href="https://github.com/SilverFruity/SimpleOCRunnerDemo" target="_blank" rel="noopener">SimpleOCRunnerDemo</a> çš„ <a href="https://github.com/SilverFruity/SimpleOCRunnerDemo/commit/850de3fe2db9ce3a059e809560bb2fb88ea3ac06" target="_blank" rel="noopener">section è¯­æ³•åˆ†æ</a>  æäº¤ä¸­ã€‚</p>
<h4 id="ç”Ÿæˆè¯­æ³•æ ‘"><a href="#ç”Ÿæˆè¯­æ³•æ ‘" class="headerlink" title="ç”Ÿæˆè¯­æ³•æ ‘"></a>ç”Ÿæˆè¯­æ³•æ ‘</h4><p>åœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¯­æ³•æ ‘ä¸­éœ€è¦çš„èŠ‚ç‚¹å¦‚ä¸‹ï¼ˆå¦‚æœå°ä¼™ä¼´æƒ³æ·»åŠ æ›´å¤šçš„è¯­æ³•ï¼Œå¯è‡ªè¡Œæ›´æ”¹ï¼‰ï¼š</p>
<p>æ‰€æœ‰èŠ‚ç‚¹éƒ½ç»§æ‰¿è‡ª<strong>ASTNode</strong>ç±»ã€‚</p>
<ol>
<li><strong>ASTSpecifierNode</strong>å˜é‡ç±»å‹èŠ‚ç‚¹ï¼š<code>int</code> , <code>double</code>  </li>
<li><strong>ASTDeclareNode</strong>å˜é‡å£°æ˜èŠ‚ç‚¹ï¼š<code>int a</code> </li>
<li><strong>ASTValueNode</strong>å€¼èŠ‚ç‚¹: <code>2</code>, <code>1.0</code>, <code>a</code></li>
<li><strong>ASTInitDeclareNode</strong>å˜é‡åˆå§‹åŒ–å£°æ˜èŠ‚ç‚¹: <code>double b = 2.0</code></li>
<li><strong>ASTBinaryNode</strong>äºŒå…ƒè¿ç®—èŠ‚ç‚¹: <code>a + b</code></li>
<li><strong>ASTScopeNode</strong>ä½œç”¨åŸŸèŠ‚ç‚¹: <code>{}</code></li>
<li><strong>ASTFunctionDeclareNode</strong>å‡½æ•°å£°æ˜èŠ‚ç‚¹: <code>int add(int arg0, double arg1)</code></li>
<li><strong>ASTFunctionImpNode</strong>å‡½æ•°èŠ‚ç‚¹:  <code>int add(int arg0, double arg1) { }</code></li>
<li><strong>ASTReturnNode </strong>returnèŠ‚ç‚¹ï¼š<code>return xxx</code></li>
<li><strong>ASTFunctionCallNode</strong>å‡½æ•°è°ƒç”¨èŠ‚ç‚¹: <code>add(a, b)</code></li>
</ol>
<p><strong>ASTSpecifierNode</strong> <code>int/double</code>ï¼šæˆ‘ä»¬è¿™é‡Œå…¶å®å°±æ˜¯ä¸€ä¸ªç®€å•æšä¸¾ï¼Œä½†æˆ‘ä»¬è¿˜æ·»åŠ äº†ç±»å‹åç§°çš„å±æ€§</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">typedef enum&#123;</span><br><span class="line">    ASTSpecifierTypeInt,</span><br><span class="line">    ASTSpecifierTypeDouble</span><br><span class="line">&#125;ASTSpecifierType;</span><br><span class="line"></span><br><span class="line">@interface ASTSpecifierNode: ASTNode</span><br><span class="line">@property (nonatomic, assign) ASTSpecifierType type;</span><br><span class="line">@property (nonatomic, strong) NSString *typeName;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p><strong>ASTDeclareNode</strong> <code>int a</code>:  å¯ä»¥çœ‹å‡ºç”±ä¸€ä¸ªå˜é‡ç±»å‹( <strong>ASTSpecifierNode</strong> )å’Œå˜é‡åç»„æˆ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@interface ASTDeclareNode: ASTNode</span><br><span class="line">@property (nonatomic, strong) ASTSpecifierNode *type;</span><br><span class="line">@property (nonatomic, strong) NSString *varname;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p><strong>ASTValueNode</strong>  <code>2</code>, <code>1.0</code>, <code>a</code>:  æœ‰ä¸‰ç§å€¼ï¼Œæ•´å‹ã€æµ®ç‚¹æ•°ã€å˜é‡å</p>
<p>åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­å­˜åœ¨ä¸¤ç§å˜é‡ï¼Œæ ‡è¯†ç¬¦ï¼š<code>a</code>ï¼Œæ ‡é‡ï¼š<code>1.0 ...</code>ï¼ŒåŒæ—¶ä¸€ä¸ªå˜é‡åªèƒ½æ‹¥æœ‰ä¸€ä¸ªå€¼å’Œä¸€ä¸ªå€¼ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨<code>enum ASTValueNodeType</code> + <code>union ASTValueNodeValue</code>çš„å½¢å¼æ¥å®Œæˆç±»å‹å’Œå€¼çš„å¯¹åº”ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">typedef enum&#123;</span><br><span class="line">    ASTValueNodeIdentifier,</span><br><span class="line">    ASTValueNodeInt,</span><br><span class="line">    ASTValueNodeDouble</span><br><span class="line">&#125;ASTValueNodeType;</span><br><span class="line"></span><br><span class="line">typedef union &#123;</span><br><span class="line">    void *pointerValue;</span><br><span class="line">    int64_t intValue;</span><br><span class="line">    double doubleValue;</span><br><span class="line">&#125;ASTValueNodeValue;</span><br><span class="line"></span><br><span class="line">@interface ASTValueNode: ASTNode</span><br><span class="line">@property (nonatomic, assign) ASTValueNodeType type;</span><br><span class="line">@property (nonatomic, assign) ASTValueNodeValue value;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p><strong>ASTInitDeclareNode</strong> <code>double b = 2.0</code>: æ­¤æ—¶æˆ‘ä»¬å†å¤„ç†åˆå§‹åŒ–å£°æ˜è¡¨è¾¾å¼çš„æ•°æ®ç»“æ„å°±å¾ˆç®€å•äº†ï¼Œç”±å˜é‡å£°æ˜èŠ‚ç‚¹å’Œå€¼èŠ‚ç‚¹ç»„æˆï¼Œç»“æ„å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@interface ASTInitDeclareNode: ASTNode</span><br><span class="line">@property (nonatomic, strong) ASTDeclareNode *declare;</span><br><span class="line">@property (nonatomic, strong) ASTNode *expression;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p><strong>ASTBinaryNode</strong> <code>a + b</code>: ä¸»è¦æœ‰å·¦å³ä¸¤ä¸ªè¡¨è¾¾å¼ä»¥åŠä¸­é—´çš„æ“ä½œç¬¦ç»„æˆ</p>
<p>äº‹å®ä¸Šï¼Œå·¦å³çš„è¡¨è¾¾å¼å¯èƒ½å¹¶ä¸å•å•åªæ˜¯ä¸€ä¸ªå˜é‡åï¼ˆæˆ–è€…è¡¨è¾¾å¼ï¼‰ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„æ˜¯<strong>ASTNode</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">typedef enum &#123;</span><br><span class="line">    ASTBinaryNodeOperatorAdd</span><br><span class="line">&#125;ASTBinaryNodeOperator;</span><br><span class="line"></span><br><span class="line">@interface ASTBinaryNode: ASTNode</span><br><span class="line">@property (nonatomic, assign) ASTBinaryNodeOperator operator;</span><br><span class="line">@property (nonatomic, strong) ASTNode *left;</span><br><span class="line">@property (nonatomic, strong) ASTNode *right;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p><strong>ASTScopeNode</strong>  <code>{}</code> ä¸­ä¸»è¦å­˜åœ¨çš„æ˜¯å¤šä¸ªè¯­æ³•èŠ‚ç‚¹ï¼Œå› æ­¤ï¼Œå…¶å±æ€§åªæœ‰ä¸€ä¸ªå­˜å‚¨èŠ‚ç‚¹çš„æ•°ç»„</p>
<p><strong>ASTFunctionDeclareNode</strong>  <code>int add(int a, double b)</code>ï¼Œä¸»è¦ç”±ä¸€ä¸ª <strong>ASTDeclareNode</strong>ï¼ˆ<code>int add</code>ï¼‰å’Œå®ƒçš„æ•°ç»„ï¼ˆ<code>int a, double b</code>ï¼‰ç»„æˆ</p>
<p><strong>ASTFunctionImpNode</strong> <code>int add(int a, double b) { }</code>ï¼Œåˆ™æ˜¯ç”±ä¸Šè¿°ä¸¤ä¸ªèŠ‚ç‚¹ç»„æˆ</p>
<p><strong>ASTFunctionCallNode</strong> <code>add(a, b)</code> ï¼Œç”±ä¸€ä¸ªè°ƒç”¨è€…èŠ‚ç‚¹å’Œå‚æ•°èŠ‚ç‚¹æ•°ç»„ç»„æˆ</p>
<p>å› æ­¤ä»–ä»¬çš„ç»“æ„å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@interface ASTScopeNode : ASTNode</span><br><span class="line">@property (nonatomic, strong) NSMutableArray *nodes;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface ASTFunctionDeclareNode: ASTNode</span><br><span class="line">@property (nonatomic, strong) ASTDeclareNode *declare;</span><br><span class="line">@property (nonatomic, strong) NSMutableArray *argDeclares;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface ASTFunctionImpNode: ASTNode</span><br><span class="line">@property (nonatomic, strong) ASTFunctionDeclareNode *declare;</span><br><span class="line">@property (nonatomic, strong) ASTScopeNode *scope;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface ASTFunctionCallNode: ASTNode</span><br><span class="line">@property (nonatomic, strong) ASTNode *caller;</span><br><span class="line">@property (nonatomic, strong) NSMutableArray *args;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆ <strong>parser.y</strong> ä¸­çš„éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼Œ<strong>globalAst</strong> ä¸ºä¸€ä¸ªå…¨å±€çš„è¯­æ³•æ ‘å˜é‡:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">door:</span><br><span class="line">statement_list</span><br><span class="line">&#123;</span><br><span class="line">    globalAst.nodes = $1;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">statement_list:</span><br><span class="line">&#123;</span><br><span class="line">    __autoreleasing id value = [NSMutableArray array];</span><br><span class="line">    $$ = value;</span><br><span class="line">&#125;</span><br><span class="line">| statement_list statement</span><br><span class="line">&#123;</span><br><span class="line">    [$1 addObject: $2];</span><br><span class="line">    $$ = $1;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">.......</span><br></pre></td></tr></table></figure>
<p>å…³äºåœ¨ <strong>.l</strong> å’Œ <strong>.y</strong>ä¸­ä¹¦å†™ä»£ç ä¸æ–¹ä¾¿çš„é—®é¢˜ï¼Œå¯ä»¥åœ¨ vscode ä¸­å®‰è£… flex å’Œ bsion çš„ç›¸å…³æ’ä»¶ï¼Œæœ‰äº†ä»£ç æç¤ºï¼Œä½“éªŒä¼šå¥½å¾ˆå¤šå¾ˆå¤šã€‚</p>
<h5 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h5><blockquote>
<p>ä¸ºä»€ä¹ˆä¼šåœ¨è¿™å„¿æåˆ°å•å…ƒæµ‹è¯•å‘¢ï¼Ÿ</p>
<p>oc2mango ä»¥åŠ OCRunner èƒ½å¤Ÿå¼€å‘å‡ºæ¥ï¼Œå•å…ƒæµ‹è¯•æœ‰è¶…å¤§åŠŸåŠ³ã€‚</p>
<p>é’ˆå¯¹ oc2mango æ–¹é¢ï¼Œéšç€é¡¹ç›®çš„å‘å±•ï¼Œè¶Šæ¥è¶Šå¤šçš„è¯­æ³•éœ€è¦æ”¯æŒï¼Œå½“ä½ åœ¨ä¿®æ”¹è¯­æ³•åˆ†æå™¨çš„æ—¶å€™ï¼Œç¨æœ‰ä¸€ä¸ªä¸æ…ï¼Œå°±ææœ‰å¯èƒ½å¯¼è‡´å·²ç»æ”¯æŒçš„è¯­æ³•å˜æˆä¸æ”¯æŒï¼Œæ²¡æœ‰å•å…ƒæµ‹è¯•çš„è¯ï¼Œåç»­çš„å¼€å‘å‡ ä¹å°±å¯¸æ­¥éš¾è¡Œäº†ã€‚ç°åœ¨åæ€ä¸€ä¸‹ï¼Œæ¯ç•™ä¸‹ä¸€ä¸ªçˆ†çº¢çš„æµ‹è¯•ç¤ºä¾‹ï¼Œæœ‰æ—¶ä¹Ÿåƒä¸€ä¸ªä¸€ä¸ªæŒ‘æˆ˜ï¼Œç­‰ç€ä½ å»å¾æœä»–ä»¬ï¼Œç»¿äº†ä»¥åæ„Ÿè§‰è´¼çˆ½ã€‚</p>
</blockquote>
<p>ä¹‹å‰æˆ‘ä»¬ä¸€ç›´æ²¡æœ‰æåˆ°å•å…ƒæµ‹è¯•ï¼Œä½†åœ¨ç›®å‰è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨å•å…ƒæµ‹è¯•äº†ï¼ˆå…¶å®æˆ‘ä»¬åœ¨æœ€å¼€å§‹çš„æ—¶å€™å°±åº”è¯¥ä½¿ç”¨çš„ğŸ˜‚ï¼Œç¯‡å¹…æœ‰é™å•Šï¼‰ã€‚</p>
<p>ç›®å‰æˆ‘ä»¬çš„å•å…ƒæµ‹è¯•ç›®æ ‡å¾ˆæ˜ç¡®ï¼šæ£€éªŒç”Ÿæˆçš„è¯­æ³•æ ‘æ˜¯å¦æ­£ç¡®ã€‚</p>
<p>é‚£æˆ‘ä»¬çš„è¾“å…¥-&gt;è¾“å‡ºçš„æ¦‚å¿µåº”è¯¥ä¸ºï¼šæºç -&gt;è¯­æ³•æ ‘-&gt;å•å…ƒæµ‹è¯•-&gt;æ˜¯å¦æ­£ç¡®ã€‚</p>
<p>ä¹‹å‰çš„ä»£ç ï¼Œæˆ‘ä»¬æ˜¯æ— æ³•é€šè¿‡ [SingleEngine run:] å¾—åˆ°è¯­æ³•æ ‘çš„ï¼Œå› æ­¤æˆ‘ä»¬åœ¨SingleEngineä¸­æ·»åŠ äº†ä¸€ä¸ª <strong>+ (AST <em>)parse: (NSString </em>)source</strong>çš„ç±»æ–¹æ³•ï¼Œç”¨äºå®Œæˆï¼šæºç -&gt;è¯­æ³•æ ‘ã€‚</p>
<p>ä¸ºäº†æ–¹ä¾¿å•å…ƒæµ‹è¯•ï¼Œä¹Ÿåœ¨ SingleEngine ä¸­ç‰¹æ„æ·»åŠ äº†ä¸€ä¸ª parserError ç”¨äºæœ€åŸºç¡€çš„è¯­æ³•æµ‹è¯•åˆ¤æ–­ã€‚</p>
<p>å½“ä½ æ‰“ç®—å°è¯•åŠ å…¥ä¸€ä¸ªæ–°çš„è¯­æ³•æ—¶ï¼Œä½ å¯ä»¥å†™ä¸€ä¸ªæœ€ç®€å•çš„å…³äº parserError çš„å•å…ƒæµ‹è¯•ï¼Œäº®ä¸€ä¸ªçº¢ç¯ã€‚</p>
<p>ç¤ºä¾‹ï¼šSimpleOCRunnerDemoTests.m ä¸­çš„ testExample ä»£ç :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">- (void)testExample &#123;</span><br><span class="line">    NSString *source =</span><br><span class="line">    @&quot;int a = 1;&quot;</span><br><span class="line">    &quot;double b = 1.0;&quot;;</span><br><span class="line">    AST *ast = [SingleEngine parse:source];</span><br><span class="line">    XCTAssert(parserError == nil, @&quot;error: %@&quot;, parserError);</span><br><span class="line">    ASTInitDeclareNode *node1 = (ASTInitDeclareNode *)ast.nodes.firstObject;</span><br><span class="line">    XCTAssert([node1 isKindOfClass:[ASTInitDeclareNode class]]);</span><br><span class="line">    XCTAssert([node1.declare.varname isEqual:@&quot;a&quot;]);</span><br><span class="line">    XCTAssert(node1.declare.type != nil);</span><br><span class="line">    XCTAssert(node1.declare.type.type == ASTSpecifierTypeInt);</span><br><span class="line">    XCTAssert([node1.expression isKindOfClass:[ASTValueNode class]]);</span><br><span class="line">    XCTAssert([(ASTValueNode *)node1.expression value].intValue == 1);</span><br><span class="line">    </span><br><span class="line">    ASTInitDeclareNode *node2 = (ASTInitDeclareNode *)ast.nodes.lastObject;</span><br><span class="line">    XCTAssert([node2 isKindOfClass:[ASTInitDeclareNode class]]);</span><br><span class="line">    XCTAssert([node2.declare.varname isEqual:@&quot;b&quot;]);</span><br><span class="line">    XCTAssert(node2.declare.type != nil);</span><br><span class="line">    XCTAssert(node2.declare.type.type == ASTSpecifierTypeDouble);</span><br><span class="line">    XCTAssert([node2.expression isKindOfClass:[ASTValueNode class]]);</span><br><span class="line">    XCTAssert([(ASTValueNode *)node2.expression value].doubleValue == 1.0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ¬å°èŠ‚ç›¸å…³ä»£ç ä½äº <a href="https://github.com/SilverFruity/SimpleOCRunnerDemo/commit/4f27bd65488a2cf9b669b1047ab242b2f8a5999d" target="_blank" rel="noopener">Section: ç”Ÿæˆè¯­æ³•æ ‘</a>.</p>
<h4 id="æ‰§è¡Œè¯­æ³•æ ‘"><a href="#æ‰§è¡Œè¯­æ³•æ ‘" class="headerlink" title="æ‰§è¡Œè¯­æ³•æ ‘"></a>æ‰§è¡Œè¯­æ³•æ ‘</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> d = <span class="number">2</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> arg0, <span class="keyword">double</span> arg1)</span></span>&#123; Â </span><br><span class="line">  <span class="keyword">return</span> arg0 + arg1 + d;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">double</span> b = <span class="number">2.0</span>;</span><br><span class="line"><span class="keyword">int</span> c = add(a, b);</span><br></pre></td></tr></table></figure>
<p>åœ¨å¼€å§‹æ­£æ–‡ä»¥å‰ï¼Œæˆ‘ä»¬å…ˆæ€è€ƒå‡ ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li><code>int a = 1;</code>ï¼Œå…³äº a çš„å€¼ï¼Œåº”å¦‚ä½•å­˜å‚¨ï¼Œå¹¶ä¸”åœ¨åç»­çš„è®¡ç®—ä¸­è¿˜èƒ½è·å–åˆ° a çš„å€¼ï¼Ÿ</li>
<li><code>int a = 1; double b = 1.0; int c = a + b;</code>ï¼Œå…³äºè¿™é‡Œï¼Œåœ¨è®¡ç®— c æ—¶ï¼Œa å’Œ b çš„å€¼ï¼Œå¦‚ä½•æ‰èƒ½è·å–åˆ°ï¼Œå¹¶ä¸” aã€b çš„å€¼æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»å‹ï¼Œå¦‚ä½•è®©ä»–ä»¬ä»¥è‡ªå·±çš„ç±»å‹è¿›è¡Œè®¡ç®—ï¼Œå¹¶ä¸”æœ€ç»ˆçš„å€¼è¢«å¼ºè½¬ä¸ºintï¼Ÿ</li>
<li><code>add(a , b);</code> å‡½æ•°è°ƒç”¨æ—¶ï¼Œå‚æ•°å¦‚ä½•ä¼ é€’ï¼Ÿ</li>
<li>åœ¨ <code>add</code> å‡½æ•°çš„è°ƒç”¨ä¸­ï¼Œ<strong>d</strong> çš„å€¼å¦‚ä½•è·å–ï¼Ÿ</li>
<li>å¦‚ä½•å…¼å®¹çš„ Objective-C çš„ <a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtTypeEncodings.html" target="_blank" rel="noopener">TypeEncode</a>ï¼Ÿ</li>
</ol>
<p>ç°åœ¨æœ‰å‡ ä¸ªæ¦‚å¿µéœ€è¦è®²ä¸€ä¸‹äº†ã€‚</p>
<h5 id="ä½œç”¨åŸŸï¼ˆEvalScopeï¼‰"><a href="#ä½œç”¨åŸŸï¼ˆEvalScopeï¼‰" class="headerlink" title="ä½œç”¨åŸŸï¼ˆEvalScopeï¼‰"></a>ä½œç”¨åŸŸï¼ˆEvalScopeï¼‰</h5><p><code>{ }</code>å°±å¯è§†ä¸ºä¸€ä¸ªä½œç”¨åŸŸï¼ŒEvalScope ä¸»è¦ç”±ä¸€ä¸ª NSMuatbleDictionary å’Œä¸€ä¸ªçˆ¶ä½œç”¨åŸŸçš„å¼•ç”¨ç»„æˆã€‚</p>
<p>å®ƒçš„ä½œç”¨ä¸»è¦æ˜¯ï¼š</p>
<p>1.å­˜å‚¨åœ¨å½“å‰ä½œç”¨åŸŸä¸­å£°æ˜çš„å˜é‡çš„å€¼ï¼Œæ¯”å¦‚: <code>int a = 1</code>ï¼ŒEvalScope[â€œaâ€] = ORValue(1)ã€‚å½“ <code>int b = a</code> è¿™ç§æƒ…å†µæ—¶ï¼Œåˆ™ä¼šå» EvalScope æŸ¥æ‰¾ â€˜aâ€™ å˜é‡çš„å€¼ï¼Œç„¶åå†æ³¨å†Œä¸€ä¸ª â€˜bâ€™ çš„å˜é‡ã€‚</p>
<p>2.çˆ¶ä½œç”¨åŸŸçš„å¼•ç”¨ä¸»è¦ç”¨äºè·¨åŸŸæ“ä½œæ—¶ï¼Œè·¨åŸŸå˜é‡æŸ¥æ‰¾ä»¥åŠä¿®æ”¹ã€‚æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œä¹Ÿå‡ºç°äº†è¿™ç§æƒ…å†µã€‚</p>
<h5 id="ä¸­é—´å€¼ï¼ˆORValueï¼‰"><a href="#ä¸­é—´å€¼ï¼ˆORValueï¼‰" class="headerlink" title="ä¸­é—´å€¼ï¼ˆORValueï¼‰"></a>ä¸­é—´å€¼ï¼ˆORValueï¼‰</h5><p>ç«™åœ¨ä½œç”¨åŸŸçš„åŸºç¡€ä¹‹ä¸Šï¼Œåœ¨å­—å…¸ä¸­ä¿å­˜çš„å€¼ï¼Œéœ€è¦æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚</p>
<p>å°½ç®¡ç›®å‰æˆ‘ä»¬åªéœ€è¦å¤„ç† int å’Œ double ç±»å‹çš„å€¼ï¼Œä½†éšç€ç±»å‹çš„å¢åŠ ï¼Œéœ€è¦ä¸€ä¸ªç±»æ¥å°è£…ç±»å‹å¤„ç†çš„ç›¸å…³é€»è¾‘ä»¥åŠå€¼åœ¨å†…å­˜ä¸­çš„å­˜å‚¨çš„ã€‚</p>
<p>ä¸ºäº†å…¼å®¹ Objective-C çš„ TypeEncodeï¼Œåœ¨ç±»ä¸­ï¼Œæ·»åŠ ä¸€ä¸ª typeEncode çš„å±æ€§ï¼Œä»¥åšåˆ°ï¼šORValue = å€¼ + TypeEncode çš„ç»„åˆã€‚</p>
<p>åŒæ—¶ï¼Œä¸ºäº†èƒ½å¤Ÿæ§åˆ¶å½“å‰çš„æ‰§è¡ŒçŠ¶æ€ï¼Œæ‹¥æœ‰ä¸€ä¸ª controlState å±æ€§ï¼Œç”¨äºåœ¨ä»£ç ä¸­å®ç° return ã€continueã€breakã€‚</p>
<h5 id="å…¨å±€å‡½æ•°è¡¨ï¼ˆFunctionTableï¼‰"><a href="#å…¨å±€å‡½æ•°è¡¨ï¼ˆFunctionTableï¼‰" class="headerlink" title="å…¨å±€å‡½æ•°è¡¨ï¼ˆFunctionTableï¼‰"></a>å…¨å±€å‡½æ•°è¡¨ï¼ˆFunctionTableï¼‰</h5><p>ä¸ºäº†å…¨å±€å‡½æ•°èƒ½å¤Ÿæ­£å¸¸è°ƒç”¨ï¼Œæ¯”å¦‚é€šè¿‡ <code>add(1, 0)</code> çš„å½¢å¼ï¼Œå³å¯è°ƒç”¨addå‡½æ•°çš„å®ç°ã€‚å› æ­¤æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªå•ä¾‹ä¸»è¦ç”¨äºå­˜å‚¨ <strong>[String : ASTFunctionImpNode]</strong> çš„å­—å…¸ã€‚</p>
<p>å…³äº <strong>ASTFunctionImpNode</strong> çš„æ³¨å†Œå’Œæ‰§è¡Œçš„é—®é¢˜ï¼š</p>
<p>å½“éå† execute è¯­æ³•æ ‘æ—¶ï¼Œæ­¤æ—¶ä¸ºç¬¬ä¸€æ¬¡è°ƒç”¨ ASTFunctionImpNode.execute ï¼Œè¿™ä¸ªæ—¶å€™ä¼šå‘å…¨å±€å‡½æ•°è¡¨è¿›è¡Œæ³¨å†Œï¼Œæ­¤æ—¶ EvalArgsStack ä¸­çš„å…ƒç´ çš„ä¸ªæ•°å¿…å®šä¸º0ã€‚æ‰€æœ‰çš„å‡½æ•°å’Œæ–¹æ³•è°ƒç”¨çš„æ—¶å€™ï¼Œæ­¤æ—¶ EvalArgsStack çš„å…ƒç´ çš„ä¸ªæ•°å¿…å®š &gt;= 1ï¼Œå› æ­¤é™¤äº†ç¬¬ä¸€æ¬¡æ³¨å†Œæ‰§è¡Œä»¥å¤–ï¼Œæ­¤å ASTFunctionImpNode æ‰€æœ‰çš„ executeï¼Œéƒ½è¿›è¡Œè§£é‡Šæ‰§è¡Œæ“ä½œã€‚</p>
<h5 id="å‡½æ•°å‚æ•°æ ˆï¼ˆEvalArgsStackï¼‰"><a href="#å‡½æ•°å‚æ•°æ ˆï¼ˆEvalArgsStackï¼‰" class="headerlink" title="å‡½æ•°å‚æ•°æ ˆï¼ˆEvalArgsStackï¼‰"></a>å‡½æ•°å‚æ•°æ ˆï¼ˆEvalArgsStackï¼‰</h5><p>å®ƒå…¶å®å¾ˆç®€å•ã€‚åœ¨å‡½æ•°è°ƒç”¨å‰ï¼Œå…ˆå°†æ‰€æœ‰çš„å‚æ•°æŒ‰ç…§é¡ºåºç»„æˆä¸€ä¸ªæ•°ç»„å‹å…¥æ ˆä¸­ï¼Œå‡½æ•°æ‰§è¡Œæ—¶ï¼Œä»æ ˆé¡¶å–å‡ºæ•°ç»„ï¼Œéšåæ³¨å†Œåˆ°å‡½æ•°ä½œç”¨åŸŸä¸­ï¼Œå½“å‡½æ•°æ‰§è¡Œå®Œæˆåï¼Œå†å°†å‚æ•°æ•°ç»„å‡ºæ ˆã€‚</p>
<p>å½“å‡½æ•°æ‰§è¡Œæ—¶ï¼Œæ˜¯å¦‚ä½•è·å–åˆ°ä»–ä»¬çš„å€¼çš„å‘¢ï¼Ÿ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//æˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹ å‡½æ•°å£°æ˜çš„ç»“æ„</span><br><span class="line">@interface ASTFunctionDeclareNode: ASTNode</span><br><span class="line">@property (nonatomic, strong) ASTDeclareNode *declare;</span><br><span class="line">@property (nonatomic, strong) NSMutableArray &lt;ASTDeclareNode *&gt;*argDeclares;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>å·²çŸ¥ <code>int add(int arg0, double arg1){ }</code> æˆ‘ä»¬è°ƒç”¨<code>add(1, 0);</code>ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨ â€˜addâ€™ åœ¨ FunctionTable ä¸­æŸ¥æ‰¾åˆ° <code>add</code> å‡½æ•°çš„å®ç°ï¼ˆASTFunctionImpNodeï¼‰ã€‚</p>
<p>è°ƒç”¨å‡½æ•°å®ç°å‰ï¼Œå…ˆæ‰§è¡Œ<code>[EvalArgsStack.push:@[ORValue(1), ORValue(0)]]</code>ã€‚</p>
<p>æœ€ç»ˆ ASTFunctionImpNode.exexcute æ—¶ï¼Œå‘ä½œç”¨åŸŸä¸­æ³¨å†Œå‚æ•°å˜é‡çš„é€»è¾‘å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span> *args = [EvalArgsStack top];</span><br><span class="line"><span class="built_in">NSArray</span> *declares = <span class="keyword">self</span>.declare.argDeclares;</span><br><span class="line">functionSubScope[declares[<span class="number">0</span>].varname] = args[<span class="number">0</span>]; <span class="comment">//functionSubScope["arg0"] = args[0];</span></span><br><span class="line">functionSubScope[declares[<span class="number">1</span>].varname] = args[<span class="number">1</span>]; <span class="comment">//functionSubScope["arg1"] = args[1];</span></span><br></pre></td></tr></table></figure>
<p>å…³äºæœ€ç»ˆä»£ç è¿è¡Œçš„é€»è¾‘å¦‚ä¸‹:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> d = <span class="number">2</span>;  <span class="comment">// TopScope[â€œdâ€] = ORValue(2);</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> arg0, <span class="keyword">double</span> arg1)</span></span>&#123; </span><br><span class="line">    <span class="comment">// ASTFunctionImpNode.exexcute(SubScope) -&gt; ORValue:</span></span><br><span class="line">    <span class="comment">// list&lt;ORValue&gt; = ArgsStack.last</span></span><br><span class="line">    <span class="comment">// SubScope[â€œarg0â€] = list[0] = ORValue(1)</span></span><br><span class="line">    <span class="comment">// SubScope[â€œarg1â€] = lsit[1] = ORValue(2.0)</span></span><br><span class="line">    <span class="comment">// d = SubScope-&gt;superScope[â€œdâ€] = TopScope[â€œdâ€] = ORValue(2)</span></span><br><span class="line">    <span class="comment">// return ORValue(1) + ORValue(2.0) + ORValue(2)</span></span><br><span class="line">    <span class="keyword">return</span> arg0 + arg1 + d;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> a = <span class="number">1</span>; <span class="comment">// TopScope[â€œaâ€] = ORValue(1);</span></span><br><span class="line"><span class="keyword">double</span> b = <span class="number">2.0</span>; <span class="comment">// TopScope[â€œbâ€] = ORValue(2.0);</span></span><br><span class="line"><span class="keyword">int</span> c = add(a, b);</span><br><span class="line"><span class="comment">// ASTFunctionImpNode = GlobalFunctionTable[â€œaddâ€]</span></span><br><span class="line"><span class="comment">// ArgsStack.push([a, b])</span></span><br><span class="line"><span class="comment">// SubScope-&gt;superScope = TopScope</span></span><br><span class="line"><span class="comment">// TopScope[â€œcâ€] = ASTFunctionImpNode.exexcute(SubScope)</span></span><br><span class="line"><span class="comment">// ArgsStack.pop()</span></span><br></pre></td></tr></table></figure>
<img src="/2021/03/09/OCRunner-SimpleOCRunner/OCRunnerExecute.png">
<p>æœ¬å°èŠ‚ç›¸å…³ä»£ç ä½äº<a href="https://github.com/SilverFruity/SimpleOCRunnerDemo/commit/33e2358c4e06baa1f35d4309b76f376a753f58fc" target="_blank" rel="noopener">Section: æ‰§è¡Œè¯­æ³•æ ‘</a>.</p>
<p>åœ¨è¿™ä¸ªç®€å•çš„ demo é‡Œé¢ï¼Œè®¸å¤šåŠŸèƒ½éƒ½è¿˜æœªå®Œæˆï¼šæ“ä½œç¬¦ã€åŸºæœ¬ç±»å‹è½¬æ¢ã€æŒ‡é’ˆã€æ–¹æ³•æ›¿æ¢ã€æ§åˆ¶è¯­å¥ã€ç»“æ„ä½“ç­‰ç­‰ï¼Œä½†æˆ‘å¸Œæœ›èƒ½å¤Ÿè®©å°ä¼™ä¼´ä»¬å¯¹è¯­æ³•æ ‘è§£é‡Šæ‰§è¡Œæœ‰ä¸€ä¸ªåŸºæœ¬çš„äº†è§£ã€‚é’ˆå¯¹æœªå®ç°çš„åŠŸèƒ½ï¼Œæƒ³æ·±å…¥çš„äººï¼Œå®Œå…¨å¯ä»¥é€šè¿‡ä¿®æ”¹ demoï¼Œå®Œæˆä»¥ä¸ŠåŠŸèƒ½ï¼Œç–‘æƒ‘çš„åœ°æ–¹ï¼Œå¯ä»¥æŸ¥çœ‹ OCRunner çš„æºç ã€‚</p>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š</strong>
    Jiang
  </li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="https://silverfruity.github.io/2021/03/09/OCRunner-SimpleOCRunner/" title="OCRunner-å®ç°ä¸€ä¸ªç®€å•ç‰ˆ OCRunner">https://silverfruity.github.io/2021/03/09/OCRunner-SimpleOCRunner/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>
    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/hotfix/" rel="tag"># hotfix</a>
          
            <a href="/tags/iOS/" rel="tag"># iOS</a>
          
            <a href="/tags/Objective-C/" rel="tag"># Objective-C</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/03/09/OCRunner-StartCodingHotFix/" rel="next" title="OCRunner-ä»é›¶æ•™ä½ å†™ä¸€ä¸ª iOS çƒ­ä¿®å¤æ¡†æ¶">
                <i class="fa fa-chevron-left"></i> OCRunner-ä»é›¶æ•™ä½ å†™ä¸€ä¸ª iOS çƒ­ä¿®å¤æ¡†æ¶
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/03/09/OCRunner-PatchFile/" rel="prev" title="OCRunner - äºŒè¿›åˆ¶è¡¥ä¸æ–‡ä»¶çš„å®ç°">
                OCRunner - äºŒè¿›åˆ¶è¡¥ä¸æ–‡ä»¶çš„å®ç° <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="Jiang">
            
              <p class="site-author-name" itemprop="name">Jiang</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#è¯æ³•åˆ†æå™¨"><span class="nav-number">1.</span> <span class="nav-text">è¯æ³•åˆ†æå™¨</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Flexè¯­æ³•ç®€å•ç®€ä»‹"><span class="nav-number">1.1.</span> <span class="nav-text">Flexè¯­æ³•ç®€å•ç®€ä»‹</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#è¯­æ³•åˆ†æå™¨"><span class="nav-number">2.</span> <span class="nav-text">è¯­æ³•åˆ†æå™¨</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Yaccè¯­æ³•ç®€å•ä»‹ç»"><span class="nav-number">2.1.</span> <span class="nav-text">Yaccè¯­æ³•ç®€å•ä»‹ç»</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ç”Ÿæˆè¯­æ³•æ ‘"><span class="nav-number">3.</span> <span class="nav-text">ç”Ÿæˆè¯­æ³•æ ‘</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#å•å…ƒæµ‹è¯•"><span class="nav-number">3.1.</span> <span class="nav-text">å•å…ƒæµ‹è¯•</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ‰§è¡Œè¯­æ³•æ ‘"><span class="nav-number">4.</span> <span class="nav-text">æ‰§è¡Œè¯­æ³•æ ‘</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#ä½œç”¨åŸŸï¼ˆEvalScopeï¼‰"><span class="nav-number">4.1.</span> <span class="nav-text">ä½œç”¨åŸŸï¼ˆEvalScopeï¼‰</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ä¸­é—´å€¼ï¼ˆORValueï¼‰"><span class="nav-number">4.2.</span> <span class="nav-text">ä¸­é—´å€¼ï¼ˆORValueï¼‰</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#å…¨å±€å‡½æ•°è¡¨ï¼ˆFunctionTableï¼‰"><span class="nav-number">4.3.</span> <span class="nav-text">å…¨å±€å‡½æ•°è¡¨ï¼ˆFunctionTableï¼‰</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#å‡½æ•°å‚æ•°æ ˆï¼ˆEvalArgsStackï¼‰"><span class="nav-number">4.4.</span> <span class="nav-text">å‡½æ•°å‚æ•°æ ˆï¼ˆEvalArgsStackï¼‰</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 &mdash; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jiang</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'VS3cQiJ0SvKu8yffcUhucXVa-gzGzoHsz',
        appKey: '7IsQXOyh5G5NhvJGb0gCQvtl',
        placeholder: 'Emmm.',
        avatar:'monsterid',
        meta:guest,
        pageSize:'10' || 10,
        visitor: true
    });
  </script>



  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
